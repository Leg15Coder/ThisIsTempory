<div class="modal-content {{get_class(quest.rarity)}}">
    {% if quest.parents or quest.children %}
    <div class="quest-chain">
        {% for parent in quest.parents|reverse %}
            <div class="quest-chain-item
                 {% if parent.status == 'Завершённый' %}completed{% endif %}
                 {% if parent.status == 'Проваленный' %}failed{% endif %}
                 {% if parent.status == 'Выполняется' %}active{% endif %}
                 {% if parent.status == 'Неактивный' %}inactive{% endif %}"

                 {% if parent.status != 'Неактивный' %}
                 onclick="openModal({{parent.id}})"
                 title="{{parent.title}}"
                 {% endif %}>
                {% if parent.status == 'Завершённый' %}✓
                {% elif parent.status == 'Проваленный' %}✗
                {% elif parent.status == 'Выполняется' %}•
                {% else %}{% endif %}
            </div>
            <div class="quest-chain-connector"></div>
        {% endfor %}

        <div class="quest-chain-item current" title="{{quest.title}}">
            {% if quest.status == 'Завершённый' %}✓
            {% elif quest.status == 'Проваленный' %}✗
            {% elif quest.status == 'Выполняется' %}•
            {% elif child.status == 'Неактивный' %}?
            {% else %}{% endif %}</div>

        {% for child in quest.children %}
            <div class="quest-chain-connector"></div>
            <div class="quest-chain-item
                 {% if child.status == 'Завершённый' %}completed{% endif %}
                 {% if child.status == 'Проваленный' %}failed{% endif %}
                 {% if child.status == 'Выполняется' %}active{% endif %}
                 {% if child.status == 'Неактивный' %}inactive{% endif %}"

                 {% if child.status != 'Неактивный' %}
                 onclick="openModal({{child.id}})"
                 title="{{child.title}}"
                 {% endif %}>
                {% if child.status == 'Завершённый' %}✓
                {% elif child.status == 'Проваленный' %}✗
                {% elif child.status == 'Выполняется' %}•
                {% elif child.status == 'Неактивный' %}?
                {% else %}{% endif %}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="modal-header">
        <h2 class="modal-title {{get_class(quest.rarity)}}" id="modalTitle">{{quest.title}}</h2>
        <div class="modal-deadline" id="modalDeadline">⏱ {{quest.deadline.strftime('%d.%m.%Y %H:%M') if quest.deadline else "бессрочно"}}</div>
    </div>
    <div class="modal-author" id="modalAuthor">От: {{quest.author}}</div>
    <p class="modal-text" id="modalText">{{quest.description}}</p>

    <div id="subtaskList">
        {% for subtask in quest.subtasks %}
            {% if subtask.type == 'checkbox' %}
                <div class="subtask-item">
                    <input type="checkbox" id="st_{{subtask.id}}" {% if subtask.completed %}checked{% endif %}
                           onchange="updateCheckboxSubtask({{quest.id}}, {{subtask.id}}, this.checked)">
                    <label for="st_{{subtask.id}}">{{subtask.description}}</label>
                    <!-- <span class="subtask-weight">({{subtask.weight}} очков)</span> -->
                </div>
            {% else %}
                <div class="subtask-item">
                    <label>{{subtask.description}}</label>
                    <div class="numeric-progress">
                        <input type="number" value="{{subtask.current}}" min="0" max="{{subtask.target}}"
                               onchange="updateNumericSubtask({{quest.id}}, {{subtask.id}}, this.value)">
                        <span>/ {{subtask.target}}</span>
                    </div>
                    <!-- <span class="subtask-weight">({{subtask.weight}} очков)</span> -->
                </div>
            {% endif %}
        {% endfor %}
    </div>

    <div class="progress-container" id="progressContainer" {% if not (quest.checkbox_subtasks or quest.numeric_subtasks) %}style="display: none;"{% endif %}>
        <div class="progress-text">Выполнено: <span id="progressPercent">{{quest.progress|default(0)}}</span>%</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: {{quest.progress|default(0)}}%"></div>
        </div>
    </div>

    <div class="modal-footer">
          <div>
              <form action="/complete/{{quest.id}}" method="POST">
                  <button class="modal-btn accept-modal-btn" type="submit">Сдать</button>
              </form>
              <form action="/delete/{{quest.id}}" method="POST">
                  <button class="modal-btn delete-modal-btn" type="submit">Удалить</button>
              </form>
          </div>
          <div>
              <form action="/fail/{{quest.id}}" method="POST">
                  <button class="modal-btn decline-modal-btn" type="submit">Провалить</button>
              </form>
              <form action="/uncomplete/{{quest.id}}" method="POST">
                  <button class="modal-btn unwatched-modal-btn" type="submit">Включить</button>
              </form>
          </div>
    </div>
</div>
