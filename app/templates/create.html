{% extends "base.html" %}
{% block content %}
<script src="{{ url_for('static', path='js/create.js') }}" defer></script>

<div class="create-container">
    <div class="create-header">
        <h1 class="create-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–≤–µ—Å—Ç</h1>
        <p class="create-subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –≤–∞—à–µ–≥–æ —ç–ø–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è</p>
    </div>

    <form action="{{ base_url }}/create" method="post" class="quest-form" id="questForm" enctype="multipart/form-data">

        <!-- Hero: –ù–∞–∑–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞ -->
        <div class="form-section hero-section">
            <div class="glow-border">
                <div class="form-group-modern">
                    <label for="questTitle" class="label-small">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞</label>
                    <input
                        type="text"
                        id="questTitle"
                        maxlength="200"
                        required
                        class="input-hero"
                        name="title"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —ç–ø–∏—á–µ—Å–∫–æ–≥–æ –∫–≤–µ—Å—Ç–∞..."
                    >
                    <div class="char-counter"><span id="titleCounter">0</span>/200</div>
                </div>
            </div>
        </div>

        <!-- –ù–∞–≥—Ä–∞–¥–∞ –∏ –†–µ–¥–∫–æ—Å—Ç—å -->
        <div class="form-row">
            <div class="form-section half">
                <div class="form-group-modern">
                    <label for="questCost" class="label-small">
                        <span class="icon">üí∞</span> –ù–∞–≥—Ä–∞–¥–∞
                    </label>
                    <div class="input-with-suffix">
                        <input
                            type="number"
                            value="100"
                            min="0"
                            id="questCost"
                            class="input-modern"
                            name="cost"
                        >
                        <span class="input-suffix">GP</span>
                    </div>
                </div>
            </div>

            <div class="form-section half">
                <div class="form-group-modern">
                    <label for="questType" class="label-small">–†–µ–¥–∫–æ—Å—Ç—å</label>
                    <div class="select-wrapper">
                        <select id="questType" class="select-modern" name="rarity">
                            <option value="common">–û–±—ã—á–Ω—ã–π</option>
                            <option value="uncommon">–ù–µ–æ–±—ã—á–Ω—ã–π</option>
                            <option value="rare">–†–µ–¥–∫–∏–π</option>
                            <option value="epic" selected>–≠–ø–∏—á–µ—Å–∫–∏–π</option>
                            <option value="legendary">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</option>
                        </select>
                        <span class="select-icon">‚ñº</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ (Accordion) -->
        <details class="form-accordion" open>
            <summary class="accordion-header">
                <span class="accordion-title">
                    <span class="icon">üìú</span> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
                </span>
                <span class="accordion-arrow">‚ñº</span>
            </summary>
            <div class="accordion-content">
                <div class="form-group-modern">
                    <label for="questDescription" class="label-small">–û–ø–∏—Å–∞–Ω–∏–µ / –ò—Å—Ç–æ—Ä–∏—è</label>
                    <textarea
                        id="questDescription"
                        rows="4"
                        class="textarea-modern"
                        name="description"
                        placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ..."
                    ></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group-modern half">
                        <label for="questAuthor" class="label-small">–ê–≤—Ç–æ—Ä</label>
                        <input
                            type="text"
                            id="questAuthor"
                            maxlength="100"
                            class="input-modern"
                            name="author"
                            placeholder="–ú–∞—Å—Ç–µ—Ä –≥–∏–ª—å–¥–∏–∏"
                            value="???"
                        >
                    </div>

                    <div class="form-group-modern half">
                        <label for="questDeadlineDate" class="label-small">–î–µ–¥–ª–∞–π–Ω</label>
                        <div class="datetime-group">
                            <input
                                type="date"
                                id="questDeadlineDate"
                                class="input-modern date-input"
                                name="deadline_date"
                            >
                            <input
                                type="time"
                                id="questDeadlineTime"
                                class="input-modern time-input"
                                name="deadline_time"
                            >
                        </div>
                    </div>
                </div>
            </div>
        </details>

        <!-- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Accordion) -->
        <details class="form-accordion">
            <summary class="accordion-header">
                <span class="accordion-title">
                    <span class="icon">üîó</span> –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
                </span>
                <span class="accordion-arrow">‚ñº</span>
            </summary>
            <div class="accordion-content">
                <div class="form-group-modern">
                    <label for="parentQuests" class="label-small">–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–≤–µ—Å—Ç—ã</label>
                    <div class="multiselect-wrapper">
                        <input
                            type="text"
                            id="parentQuestsSearch"
                            class="input-modern search-input"
                            placeholder="üîç –ü–æ–∏—Å–∫ –∫–≤–µ—Å—Ç–æ–≤ –ø–æ ID –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—é..."
                            aria-label="–ü–æ–∏—Å–∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –∫–≤–µ—Å—Ç–æ–≤"
                        >
                        <select
                            id="parentQuests"
                            class="select-modern multiselect"
                            name="parent_quests"
                            multiple
                            size="5"
                        >
                            {% for available_quest in available_quests %}
                            <option value="{{ available_quest.id }}" title="{{ available_quest.description }}">
                                #{{ available_quest.id }} - {{ available_quest.title }} ({{ available_quest.rarity.value }})
                            </option>
                            {% endfor %}
                        </select>
                        <div class="help-text">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl (Windows) –∏–ª–∏ Cmd (Mac) –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</div>
                    </div>
                </div>
            </div>
        </details>

        <!-- –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å (Accordion) -->
        <details class="form-accordion">
            <summary class="accordion-header">
                <span class="accordion-title">
                    <span class="icon">üîÑ</span> –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å
                </span>
                <span class="accordion-arrow">‚ñº</span>
            </summary>
            <div class="accordion-content">
                <div class="form-group-modern">
                    <label class="toggle-container">
                        <input type="checkbox" id="isRecurrence" name="is_recurrence">
                        <span class="toggle-switch"></span>
                        <span class="label-text">–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –∫–≤–µ—Å—Ç–∞</span>
                    </label>
                </div>

                <div id="recurrenceOptions" style="display: none; margin-top: 1rem;">
                    <div class="form-row">
                        <div class="form-group-modern half">
                            <label for="recurrenceType" class="label-small">–¢–∏–ø –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</label>
                            <select id="recurrenceType" class="select-modern" name="recurrence_type">
                                <option value="daily">üóìÔ∏è –ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                                <option value="weekly">üìÖ –ü–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏</option>
                                <option value="interval">‚è±Ô∏è –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª</option>
                            </select>
                        </div>
                        <div class="form-group-modern half">
                            <label for="questDuration" class="label-small">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)</label>
                            <input
                                type="number"
                                id="questDuration"
                                name="duration_hours"
                                class="input-modern"
                                min="1"
                                value="24"
                            >
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-modern half">
                            <label for="recurrenceStartDate" class="label-small">–î–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞</label>
                            <input
                                type="date"
                                id="recurrenceStartDate"
                                name="start_date"
                                class="input-modern"
                            >
                        </div>
                        <div class="form-group-modern half">
                            <label for="recurrenceStartTime" class="label-small">–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞</label>
                            <input
                                type="time"
                                id="recurrenceStartTime"
                                name="start_time"
                                class="input-modern"
                            >
                        </div>
                    </div>

                    <!-- –û–ø—Ü–∏–∏ –¥–ª—è weekly -->
                    <div id="weeklyOptions" class="form-group-modern" style="display: none;">
                        <label class="label-small">–î–Ω–∏ –Ω–µ–¥–µ–ª–∏</label>
                        <div class="weekdays-selector">
                            <label><input type="checkbox" name="weekdays" value="0"> <span>–ü–Ω</span></label>
                            <label><input type="checkbox" name="weekdays" value="1"> <span>–í—Ç</span></label>
                            <label><input type="checkbox" name="weekdays" value="2"> <span>–°—Ä</span></label>
                            <label><input type="checkbox" name="weekdays" value="3"> <span>–ß—Ç</span></label>
                            <label><input type="checkbox" name="weekdays" value="4"> <span>–ü—Ç</span></label>
                            <label><input type="checkbox" name="weekdays" value="5"> <span>–°–±</span></label>
                            <label><input type="checkbox" name="weekdays" value="6"> <span>–í—Å</span></label>
                        </div>
                    </div>

                    <!-- –û–ø—Ü–∏–∏ –¥–ª—è interval -->
                    <div id="intervalOptions" class="form-group-modern" style="display: none;">
                        <label for="intervalHours" class="label-small">–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (—á–∞—Å—ã)</label>
                        <input
                            type="number"
                            id="intervalHours"
                            name="interval_hours"
                            class="input-modern"
                            min="1"
                            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 12"
                        >
                    </div>

                    <!-- –û–∫–æ–Ω—á–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–∞ -->
                    <div id="recurrenceEnd" class="form-row" style="margin-top:0.8rem; display:none;">
                        <div class="form-group-modern half">
                            <label for="recurrenceEndDate" class="label-small">–ü–æ–≤—Ç–æ—Ä—è—Ç—å –¥–æ –¥–∞—Ç—ã</label>
                            <input type="date" id="recurrenceEndDate" name="end_date" class="input-modern">
                        </div>
                        <div class="form-group-modern half">
                            <label for="recurrenceEndTime" class="label-small">–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                            <input type="time" id="recurrenceEndTime" name="end_time" class="input-modern">
                        </div>
                    </div>
                </div>
            </div>
        </details>

        <!-- –ü–æ–¥–∑–∞–¥–∞—á–∏ -->
        <div class="form-section">
            <div class="objectives-header">
                <h3 class="objectives-title">
                    <span class="icon">‚úì</span> –ü–æ–¥–∑–∞–¥–∞—á–∏
                </h3>
                <div class="objectives-buttons">
                    <button type="button" id="addCheckbox" class="btn-add-objective" title="–î–æ–±–∞–≤–∏—Ç—å —á–µ–∫–±–æ–∫—Å">
                        <span class="icon">‚òë</span>
                        <span class="btn-text">–ß–µ–∫–±–æ–∫—Å</span>
                    </button>
                    <button type="button" id="addNumeric" class="btn-add-objective" title="–î–æ–±–∞–≤–∏—Ç—å —á–∏—Å–ª–æ–≤—É—é —Ü–µ–ª—å">
                        <span class="icon">üî¢</span>
                        <span class="btn-text">–ß–∏—Å–ª–æ–≤–∞—è</span>
                    </button>
                </div>
            </div>

            <div id="subtasksList" class="subtasks-list"></div>

            <div class="empty-objectives" id="emptyObjectives">
                <span class="icon">üìã</span>
                <p>–ü–æ–¥–∑–∞–¥–∞—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                <p class="hint">–î–æ–±–∞–≤—å—Ç–µ —á–µ–∫–±–æ–∫—Å—ã –∏–ª–∏ —á–∏—Å–ª–æ–≤—ã–µ —Ü–µ–ª–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
        <div class="form-footer">
            <button type="submit" class="btn-create-quest">
                <span class="icon">‚ú®</span>
                –°–æ–∑–¥–∞—Ç—å –∫–≤–µ—Å—Ç
            </button>
        </div>
    </form>
</div>

{% endblock %}
